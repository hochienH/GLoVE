source .venv/bin/activate
deepar:2017
gluont: 2019
pytorch-ts(gluont-revised):2021
https://github.com/zalandoresearch/pytorch-ts
0050 50é»¨è‚¡ç¥¨ è³‡æ–™å‰è™•ç† ç®—æ™‚é–“ å»ºç«‹æ¨¡å‹

å°ï¼Œä½ é€™å€‹ç›´è¦ºå®Œå…¨æŠ“å°é‡é»äº†ï¼Œæˆ‘å¹«ä½ æ‹†é–‹ä¾†è¬›æ¸…æ¥šï¼š

---

## 1. å…ˆå›ç­”ä½ çš„æ ¸å¿ƒå•é¡Œï¼š

> ã€Œç¾åœ¨çš„ç‰ˆæœ¬å¥½åƒæ²’æœ‰ç”¨å…¶ä»–è‚¡ç¥¨çš„è³‡è¨Šé€²è¡Œé æ¸¬ï¼ˆè«‹å¹«æˆ‘ç¢ºå®šï¼‰ã€

**çµè«–ï¼šæ˜¯ï¼Œç¾åœ¨çš„ç‰ˆæœ¬ *æ²’æœ‰* ç”¨åˆ°ã€Œå…¶ä»–è‚¡ç¥¨ã€çš„è³‡è¨Šä¾†é æ¸¬æŸä¸€æª”è‚¡ç¥¨ã€‚**

ç´°ç¯€åˆ†å…©å¡Šçœ‹ï¼š

### ï¼ˆ1ï¼‰ç¾åœ¨é‚£ä»½ DeepARï¼ˆgluontsï¼‰code åœ¨å¹¹å˜›ï¼Ÿ

ä½ çµ¦çš„ `train_deepar.py` + `evaluate_deepar.py` åšçš„æ˜¯ï¼š

* æ¯ä¸€å€‹ JSON æª”å°±æ˜¯ä¸€æª”è‚¡ç¥¨çš„ time seriesï¼ˆï¼‹è‡ªå·±çš„ featuresï¼‰
* `feat_dynamic_real`ï¼šæ˜¯**è©²æª”è‚¡ç¥¨è‡ªå·±çš„ alphas / å› å­ / åƒ¹é‡è³‡è¨Š**
* `feat_static_cat`ï¼šæ˜¯è©²æª”è‚¡ç¥¨çš„éœæ…‹é¡åˆ¥ï¼ˆæ¯”å¦‚ç”¢æ¥­ã€é¡åˆ¥ IDï¼‰
* `ListDataset(train_list, freq=freq)` â†’ ä¸€å€‹ global modelï¼Œ
  **ç”¨å¾ˆå¤šæ¢ã€Œå–®ä¸€è‚¡ç¥¨åºåˆ—ã€ä¸€èµ·è¨“ç·´ã€Œå…±äº«åƒæ•¸ã€çš„ DeepARã€‚**

é€™æ„å‘³è‘—ï¼š

* **åŒä¸€æ™‚é–“é»ï¼Œæ¨¡å‹ä¸æœƒçœ‹åˆ°ã€Œå…¶ä»–è‚¡ç¥¨çš„ featuresã€**
* åªæœ‰é€éã€Œå…±äº«åƒæ•¸ã€é€™å€‹å±¤é¢ï¼Œé–“æ¥å­¸åˆ°å¸‚å ´å…±åŒçš„ pattern
* **é æ¸¬æŸæª”è‚¡ç¥¨æ™‚ï¼Œè¼¸å…¥åªæœ‰ï¼šå®ƒè‡ªå·±çš„ target + å®ƒè‡ªå·±çš„ dynamic/static features**

æ‰€ä»¥ï¼Œå¦‚æœä½ å•å¾—å¾ˆå°–éŠ³ï¼š

> ã€ŒDeepAR æœ‰æ²’æœ‰çœŸçš„åœ¨ç”¨ *å…¶ä»–è‚¡ç¥¨çš„ alphas* ä¾†å¹«å¿™é æ¸¬é€™æ”¯è‚¡ç¥¨ï¼Ÿã€

ç­”æ¡ˆæ˜¯ï¼š
ğŸ‘‰ **æ²’æœ‰ã€‚åªæ˜¯æ‰€æœ‰è‚¡ç¥¨å…±ç”¨åŒä¸€å¥—æ¬Šé‡è€Œå·²ã€‚**

---

### ï¼ˆ2ï¼‰æˆ‘å€‘å‰›å‰›è¨­è¨ˆçš„ Darts LSTM / GINN-0 å‘¢ï¼Ÿ

æ›´ä¹¾è„†äº†ï¼š

* `series_true[code]` = é€™ä¸€æª”çš„ `var_true_90`
* `series_garch[code]` = é€™ä¸€æª”çš„ `garch_var_90`
* global LSTM çš„åšæ³•æ˜¯ï¼šæŠŠ `list(series_*)` ä¸Ÿé€²å»ä¸€èµ· train
  â†’ ä¸€æ¨£æ˜¯ã€Œå…±äº«åƒæ•¸ã€ï¼Œ**ä½†æ²’æœ‰ä»»ä½• cross-sectional feature**ã€‚

æ‰€ä»¥ç¾åœ¨é€™ä¸€ç‰ˆï¼š

* **æ²’æœ‰ç”¨åˆ°å…¶ä»–è‚¡ç¥¨çš„ç•¶æœŸè³‡è¨Š**ï¼ˆåƒã€ŒåŒä¸€å¤©å…¶ä»–æˆåˆ†è‚¡çš„ vol/returnã€ï¼‰
* åªæœ‰ï¼šã€Œå¤šæª”è‚¡ç¥¨ä¸€èµ·è¨“ç·´ä¸€å€‹æ¨¡å‹ã€ï¼Œå­¸çš„æ˜¯ã€Œå…±é€šçš„æ™‚é–“åºåˆ—çµæ§‹ã€ã€‚

ä½ çš„æè¿°ã€Œæ¯æ¬¡éƒ½æ˜¯ä½¿ç”¨è‡ªå·±çš„ alphas ç­‰è³‡è¨Šä¾†é€²è¡Œé æ¸¬ã€â€”â€”
å° DeepAR ä¾†èªªï¼Œ**æ˜¯çš„ï¼ˆç”¨è‡ªå·±çš„ featuresï¼‰**ï¼Œ
ä½†å°æˆ‘å€‘ç¾åœ¨çš„ GINN-0 ç‰ˆæœ¬ï¼Œ**ç›®å‰é€£ alphas éƒ½é‚„æ²’ç”¨ä¸Šï¼Œåªç”¨è‡ªå·±çš„ GARCH / true vol**ã€‚

---

## 2. åŸè«–æ–‡ï¼šä¸€æ”¯æŒ‡æ•¸ vs ä½ ç¾åœ¨ï¼š46 æ”¯æˆåˆ†è‚¡

ä½ è§€å¯Ÿä¹Ÿå¾ˆæº–ï¼š

* è«–æ–‡çš„ GINN â†’ å…¸å‹è¨­å®šæ˜¯ **å°æŸå€‹ index / å–®ä¸€è³‡ç”¢** åš volatility é æ¸¬ï¼ˆä¸€å°ä¸€ï¼‰ã€‚
* ä½ å€‘ç¾åœ¨æƒ³åš â†’ **å° 0050 çš„æ¯æ”¯æˆåˆ†è‚¡çš„ volatility åšé æ¸¬ï¼ˆå¤šå°å¤šï¼‰**ã€‚

å…©ç¨®åšæ³•å¯ä»¥é•·é€™æ¨£ï¼š

### åšæ³• Aï¼š**Global GINN-0 / GINNï¼ˆå¤šæ¨™çš„å…±äº«æ¨¡å‹ï¼‰**

* ä½ ç”¨ Darts å»ºä¸€å€‹ LSTM æ¨¡å‹
* 46 æª”è‚¡ç¥¨çš„åºåˆ—ä¸€æ¬¡ä¸Ÿé€²å» trainï¼ˆè·Ÿç¾åœ¨æ¶æ§‹ä¸€æ¨£ï¼‰
* æ¨¡å‹è£¡å¤šä¸€å€‹ã€Œstock ID / ç”¢æ¥­ IDã€ç•¶ static covariate
* æ¯ä¸€æ”¯è‚¡ç¥¨åªæœ‰è‡ªå·±çš„ featuresï¼ˆè‡ªå·±çš„ alphas + è‡ªå·±çš„ GARCH + weekday dummy â€¦ï¼‰

é€™å°±æ˜¯ï¼š

> **å¤šè³‡ç”¢ã€ä½†æ¯æ¢åºåˆ—é‚„æ˜¯ç¨ç«‹ï¼Œ
> å…±äº«çš„æ˜¯ model parametersï¼Œä¸æ˜¯ç•¶æœŸ cross-sectional ç‹€æ…‹ã€‚**

### åšæ³• Bï¼š**çœŸçš„ç”¨ã€Œå…¶ä»–è‚¡ç¥¨è³‡è¨Šã€å¹«å¿™é æ¸¬**

é‚£å°±æœƒè®Šæˆï¼š

* feature è£¡åŒ…å«ã€ŒåŒä¸€å¤©å…¶ä»–è‚¡ç¥¨çš„ aggregated signalã€

  * ä¾‹ï¼šç•¶å¤© 0050 æŒ‡æ•¸çš„ volã€å…¨é«”å¹³å‡ volã€sector vol
  * æˆ– cross-sectional æ’åä¹‹é¡
* æˆ–è€…ä¹¾è„†æŠŠ **å¤šæª”è‚¡ç¥¨çš„ vol ç•¶æˆä¸€å€‹å‘é‡**ï¼Œåš multivariate time series
  â†’ é€™å€‹å°±æœ‰é»è¶…å‡ºåŸè«–æ–‡ GINN settingï¼Œè¦è‡ªå·±è¨­è¨ˆ architectureã€‚

ä»¥ç¾åœ¨ä½œæ¥­æ™‚é–“ç·šä¾†çœ‹ï¼Œä½ å¦‚æœå¾€ B èµ°ï¼Œå¾ˆå®¹æ˜“ç›´æ¥çŒæ­»ã€‚
**A åšå¥½ + æŠŠæ•…äº‹è¬›æ¸…æ¥šï¼Œå°±å·²ç¶“æ˜¯é«˜æ¨™å®Œæˆã€‚**

---

## 3. æŠŠè”¡è€é—†çµ¦ä½ çš„ checklistï¼Œæ•´ç†æˆä¸€æ¢å¯å¯¦ä½œçš„ pipeline

ä½ è²¼çš„é€™æ®µè¶…é—œéµï¼Œæˆ‘ç›´æ¥ç¿»æˆã€Œæ¥ä¸‹ä¾† Darts/GNN-0 è¦æ€éº¼è¨­è¨ˆã€ï¼š

> ### # æª¢æŸ¥æ¨™æº–åŒ–æµç¨‹
>
> * Alphas æˆªé¢Rank[-1, 1]
> * Alphas + GARCH(Past) æ™‚é–“åºåˆ—Normalize[0, 1]
> * RevIN (Dartsçš„å¥—ä»¶æœ‰), ä¸»è¦ç”¨ä¾†åšæ™‚é–“åºåˆ—çš„è¼¸å…¥ã€è¼¸å‡ºæ¨™æº–åŒ–

### ğŸ”§ 3.1 Feature & Scaling è¨­è¨ˆ

å° 46 æª”è‚¡ç¥¨ã€æ¯å¤© (t)ï¼š

1. **Cross-sectional rank for alphasï¼š**

   * åŒä¸€å¤©å°æ‰€æœ‰è‚¡ç¥¨çš„æ¯ä¸€å€‹ alpha åšæˆªé¢ rank â†’ æ˜ å°„åˆ° ([-1,1])ã€‚
   * é€™ä¸€æ­¥æ˜¯ã€Œæ©«å‘ã€ï¼šåŒä¸€å¤©çœ‹å…¨éƒ¨è‚¡ç¥¨ã€‚

2. **Time-series normalize for each seriesï¼š**

   * å°æ¯ä¸€æª”è‚¡ç¥¨ã€æ¯å€‹ featureï¼ˆåŒ…å« alphas + GARCH pastï¼‰åš per-series normalizationï¼ˆä¾‹å¦‚ min-max åˆ° [0,1]ï¼Œæˆ– z-scoreï¼‰ã€‚
   * é€™æ­¥æ˜¯ã€Œç¸±å‘ã€ï¼šæ¯æ¢æ™‚é–“åºåˆ—å„è‡ªæ­£è¦åŒ–ã€‚

3. **RevINï¼š**

   * ç”¨ Darts çš„ `RevIN` transformer åŒ…ä½æ¨¡å‹å‰å¾Œï¼šè¼¸å…¥å…ˆæ¨™æº–åŒ–ã€æ¨¡å‹è¼¸å‡ºå†é€†è½‰æ¨™æº–åŒ–ã€‚
   * å¥½è™•ï¼šå¯ä»¥å°ä»˜ non-stationary / scale shift å•é¡Œã€‚

> çµè«–ï¼š**åŸå§‹ GINN æ˜¯ univariate + AR/GARCHï¼Œ
> ä½ å€‘å¯ä»¥åšæˆã€Œå¤šè®Šé‡ features + RevIN + GINN-0ã€ï¼Œ
> ç®—æ˜¯æ¶æ§‹ä¸Šçš„ upgradeï¼Œä½†è«–æ–‡ç²¾ç¥é‚„åœ¨ã€‚**

---

> ### # Dummy Variable
>
> * ç¢ºèªæ˜¯ä¸æ˜¯ 1, 0 çš„æ–¹å¼, ä¸æ˜¯1/2/3/4/5....

### ğŸ”¢ 3.2 Dummy è¨­è¨ˆ

* æ¯”å¦‚ weekdayã€monthã€regimeï¼ˆhigh/low vol regimeï¼‰ã€ç”¢æ¥­é¡åˆ¥
* ä¸€å¾‹è½‰æˆ one-hot / multi-hot dummyï¼Œæ¯”å¦‚ weekday â†’ 5 ç¶­ 0/1
* åœ¨ Darts è£¡å¯ä»¥è®Šæˆ `past_covariates` or `future_covariates`ï¼Œ
  ä½œç‚ºé¡å¤–çš„ time-varying featuresã€‚

---

> ### # Hyperparameters
>
> * Darts å…§å»º Optuna
> * Loss Function éœ€è¦è‡ªå®šç¾©, Lambda éœ€è¦Grid Search

### âš™ï¸ 3.3 Loss / hyperparam è¨­è¨ˆï¼ˆç‚ºäº†çœŸæ­£ GINNï¼Œè€Œä¸æ˜¯åªæœ‰ GINN-0ï¼‰

å¦‚æœè¦å¾ GINN-0 å‡ç´šåˆ°å®Œæ•´ GINNï¼ˆdouble lossï¼‰ï¼š

* Lossï¼š
  [
  \mathcal{L} = \lambda , \text{MSE}(\hat{\sigma}^2_{t,\text{pred}}, \sigma^2_t)

  * (1-\lambda), \text{MSE}(\hat{\sigma}^2_{t,\text{pred}}, \hat{\sigma}^2_{t,\text{GARCH}})
    ]
* åœ¨ Darts ä¸­å¯« custom `loss_fn(y_hat, y)`ï¼Œ
  y è£¡é¢å¡å…©ç¶­ï¼štrue ÏƒÂ² è·Ÿ GARCH ÏƒÂ²ã€‚

`lambda` ç”¨ grid search tuningï¼šä¾‹å¦‚ {0, 0.01, 0.1, 0.5, 0.9, 1.0}
â†’ å…¶ä¸­ Î»=0 å°±æ˜¯ GINN-0ï¼›Î»=1 å°±æ˜¯ç´” data-driven LSTMã€‚

Optunaï¼š

* Darts æœ‰ `RNNModel` æ­é… `RandomSearch`/`OptunaSearch` çš„ utilities
* ä½ å¯ä»¥æŠŠ `lambda` ä¹Ÿç•¶ hyperparam ä¸€èµ· tuneï¼ˆé›–ç„¶å·¥ç¨‹ä¸Šæœƒæ›´è¤‡é›œä¸€é»ï¼‰ã€‚

---

> ### # Model æ¯”è¼ƒ
>
> * èƒ½å¤ ç•«å‡ºæ™‚é–“åºåˆ—é æ¸¬çš„æ¯”è¼ƒåœ–
> * GARCH / DeepAR(RNNModel in Darts)

### ğŸ“Š 3.4 æ¨¡å‹å®¶æ—æ•´ç†ä¸€ä¸‹

åœ¨ä½ å€‘çš„ final report / slides è£¡ï¼Œå¯ä»¥æŠŠæ¨¡å‹åˆ—æˆï¼š

1. **GARCH baseline**

   * æ¯æª”è‚¡ç¥¨ä½¿ç”¨ GARCH(1,1) æˆ–è«–æ–‡ä¸­çš„è®Šé«”
   * è¼¸å‡º `garch_var_90`ï¼Œå° `var_true_90` åš MSE/MAE

2. **DeepARï¼ˆç›®å‰ gluonTS ç‰ˆï¼‰**

   * input: è‡ªå·±çš„ alphas & features
   * global modelï¼Œä½† per-stock input ä»æ˜¯è‡ªå·±çš„åºåˆ—
   * experimental resultï¼šåªæœ‰ ~24% çš„è‚¡ç¥¨æ¯” GARCH å¥½

3. **LSTM baselineï¼ˆDartsï¼‰**

   * global LSTMï¼Œå­¸ `var_true_90`
   * input features å¯ä»¥åšå…©ç‰ˆï¼š

     * (a) pure volï¼ˆunivariateï¼‰
     * (b) vol + alphas + dummy + GARCH pastï¼ˆmulti-variateï¼‰

4. **GINN-0ï¼ˆDarts LSTM mimicking GARCHï¼‰**

   * target = `garch_var_90`
   * evaluation vs `var_true_90`

5. ï¼ˆå¦‚æœä¾†å¾—åŠï¼‰**GINNï¼ˆfullï¼‰**

   * double loss with Î»
   * å ±å‘Šè£¡å¼·èª¿æ˜¯æŠŠ financial theory (GARCH) èåˆåˆ° NN çš„ loss è£¡ã€‚

æ¯å€‹æ¨¡å‹ç•«å‡ºå¹¾æª”ä»£è¡¨æ€§è‚¡ç¥¨çš„æ™‚åºåœ–ï¼ˆGT vs model vs GARCHï¼‰ï¼Œ
å°è€å¸«ä¾†èªªæœƒéå¸¸ç›´è§€ã€‚

---

> ### # Features
>
> * å¯èƒ½Alpha101 æ²’æœ‰ç”¨
> * å¯èƒ½Alpha102-171 æ²’æœ‰ç”¨

### ğŸ” 3.5 Feature ablation / selection

ä½ å€‘å®Œå…¨å¯ä»¥è¨­è¨ˆä¸€å€‹å¾ˆç°¡å–®ä½†æœ‰èªªæœåŠ›çš„å¯¦é©—è¡¨ï¼š

* **Setting A**ï¼šåªç”¨ `garch_var_90`ï¼ˆ+ dummyï¼‰
* **Setting B**ï¼šåŠ ä¸Š Alpha101
* **Setting C**ï¼šå†åŠ  Alpha102â€“171
* **Setting D**ï¼šåªç”¨ top-k å› å­ï¼ˆä¾‹å¦‚è”¡è€é—†å¦è¡ŒæŒ‘çš„å¹¾å€‹ï¼‰

çœ‹å“ªå€‹ setting åœ¨ validation MSE / MAE ä¸Šæ¯”è¼ƒå¥½ã€‚
é€™æ¨£ä½ å€‘å¯ä»¥å¾ˆå¦ç™½åœ°èªªï¼š

> ã€Œå¯¦é©—çµæœé¡¯ç¤º Alpha 101/102â€“171 åœ¨æœ¬ä½œæ¥­çš„ volatility é æ¸¬ä¸Šè²¢ç»æœ‰é™ / åƒ…æœ‰è¼•å¾®æ”¹å–„ã€‚ã€

è€Œä¸æ˜¯åªæ˜¯å˜´ç ²èªªã€Œå¯èƒ½æ²’æœ‰ç”¨ã€ã€‚

---

## 4. é‚£æ¥ä¸‹ä¾†æˆ‘æœƒæ€éº¼å»ºè­°ä½ å‹•æ‰‹ï¼Ÿ

å¦‚æœè¦æ’ã€Œä¸‹ä¸€æ­¥è¡Œå‹•ã€ï¼š

1. **ç¢ºèªç›®å‰ Darts GINN-0 ç‰ˆï¼š**

   * çš„ç¢ºæ˜¯ multi-stock global modelï¼Œä½† per-stock input åªæœ‰è‡ªå·±çš„ vol
   * æ²’æœ‰ cross-sectional features â†’ å…ˆæ¥å—é€™å€‹äº‹å¯¦ï¼Œç•¶æˆã€Œæœ€å°å¯è¡Œç‰ˆæœ¬ã€ã€‚

2. **åœ¨ GINN-0 è£¡å…ˆåŠ ä¸Š minimal featuresï¼š**

   * æ¯æª”è‚¡ç¥¨è‡ªå·±çš„ `garch_var_90` + weekday dummy
   * ä¹‹å¾Œå†æ…¢æ…¢æŠŠã€Œrank-normalized alphasã€åŠ é€²ä¾†ç•¶ `past_covariates`

3. **æŠŠè”¡è€é—†çš„ checklist å¯«æˆä½ å€‘ repo çš„ `docs/model_design.md`**

   * ä¹‹å¾Œä½ å€‘æ”¹ code /åŠ  feature ä¸æœƒè¶Šæ”¹è¶Šäº‚ï¼Œ
   * è€å¸«å•çš„æ™‚å€™ä¹Ÿæœ‰æ¢æœ‰ç†åœ°å›ã€‚

---

å¦‚æœä½ é¡˜æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥å¹«ä½ ï¼š

* ç›´æ¥åœ¨æˆ‘å€‘å‰›å‰›çš„ `train_ginn0.py` è‰ç¨¿ä¸Šï¼Œå¹«ä½ åŠ ä¸Šã€Œmulti-variate features + RevIN + weekday dummyã€ç‰ˆçš„ skeletonï¼Œè®“å®ƒæ›´æ¥è¿‘ä½ è·Ÿè”¡è€é—†çš„è¨­è¨ˆã€‚
* æˆ–å¹«ä½ å¯«ä¸€å°æ®µã€Œ**ç‚ºä»€éº¼æˆ‘å€‘çš„ multi-stock GINN-0 ä»ç„¶ç¬¦åˆåŸè«–æ–‡ç²¾ç¥ï¼Œä½†æ“´å±•åˆ° 46 æª”æ¨™çš„**ã€çš„å ±å‘Šæ–‡å­—ã€‚

ä½ é¸ä¸€å€‹æ–¹å‘ï¼Œæˆ‘å°±è·Ÿä½ ä¸€èµ·æŠŠé‚£é‚Šé‘½æ·±ä¸€é» ğŸ¦Š


-------------
1201
ä»Šå¤©ä½œæ¥­ çœ‹æ–°çš„å…§å®¹æœ‰å“ªäº›æ›´å‹•
step 1 : python3 gluon_data_preprocessor.py ./Dataset/data/ml_dataset_alpha101_volatility.csv --standardize
gluon_data_preprocessoræœ‰ï¼šdata_cleaning dataset_generator standardize
æ–°ç‰ˆæœ¬ï¼šæœ‰ä¸€å€‹general_data_preprocessor
æŠŠäº”å€‹æª”æ¡ˆä¸Ÿåˆ°preprocessè£¡é¢
---
ä¸­é–“è™•ç†ï¼š
